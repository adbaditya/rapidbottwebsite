<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Processing Payment…</title>

  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">

  <script src="https://mercury.phonepe.com/web/bundle/checkout.js"></script>

  <style>
    body { 
      font-family: system-ui; 
      text-align: center; 
      padding-top: 40px; 
    }
  </style>
</head>
<body>

<h2>Redirecting to Payment…</h2>
<p>Please wait…</p>

<script>
  function getParam(key) {
    const url = new URL(window.location.href);
    return url.searchParams.get(key);
  }

  const tokenUrl = decodeURIComponent(getParam("token"));
  const orderId = getParam("order");

  if (!tokenUrl) {
    document.body.innerHTML = "<h1>Invalid Payment Link</h1>";
    throw new Error("Missing tokenUrl");
  }

  // Start PhonePe Checkout
  window.PhonePeCheckout.transact(
    {
      tokenUrl,
      type: "IFRAME"
    },
    function callback(result) {
      console.log("PhonePe result:", result);

      if (result === "USER_CANCEL") {
        window.location.href = "/payment-cancelled";
      } else if (result === "CONCLUDED") {
        window.location.href = "/payment-success?order=" + orderId;
      }
    }
  );
</script>

</body>
</html>
